<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project 2</title>

  <!-- Favicons -->
  <link href="images/final-logo.png" rel="icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap JS (Popper.js and Bootstrap JS) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Include jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Bootstrap Icons CSS -->
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">

  <!-- Include DataTables JS -->
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.js"></script>

   <!-- Include DataTables CSS with additional styling -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.css">

  <link rel="stylesheet" href="static/style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&display=swap">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>

  <!-- Include Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ===== Iconscout CSS ===== -->
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
  <link rel="stylesheet" href="assets/css/signin.css">
      
  <script src="https://kit.fontawesome.com/334c45a40c.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" ></script>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>

<div class="container-fluid">

<!-- ======= Navigation ======= -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <a class="navbar-brand" href="dashboard.html">Project 2</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
    aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ms-auto"> <!-- Use ms-auto to push items to the right -->
      <li class="nav-item active">
        <a class="nav-link" href="dashboard.html">Dashboard <span class="sr-only"></span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="project1.html">Project 1 <span class="sr-only"></span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="project3.html">Project 3 <span class="sr-only"></span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="logoutBtn" href="#">
          <!-- Replace the text with a Bootstrap icon for logout -->
          <i class="bi bi-box-arrow-up"></i>Logout
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- ======= Main ======= -->
<div class="card">
    <div class="card-body">

        <div class="container">
            <!-- Container for file input and buttons with dark blue transparent background -->
            <div class="file-container">
                <h5 class="card-title">Add Flooding Case</h5>
                <!-- Add Flood Case -->
                <form class="add" id="addForm">
                    <div class="mb-3">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="latitude" placeholder="Latitude" name="latitude" required>
                            <label for="latitude">Latitude</label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="longitude" placeholder="Longitude" name="longitude" required>
                            <label for="longitude">Longitude</label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="flood_height" placeholder="Flood Height" name="flood_height" required>
                            <label for="flood_height">Flood Height</label>
                        </div>
                    </div>

                    <div class="mb-3">
                      <div class="form-floating">
                          <input type="text" class="form-control" id="elevation" placeholder="Elevation" name="elevation" required>
                          <label for="elevation">Elevation</label>
                      </div>
                  </div>

                  <div class="mb-3">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="precipitation" placeholder="Precipitation" name="precipitation" required>
                        <label for="precipitation">Precipitation</label>
                    </div>
                </div>

                    <!-- <div class="mb-3">
                        <div class="form-floating">
                            <input type="date" class="form-control" id="elevation" placeholder="Date Reported" name="date" required>
                            <label for="elevation">Date Reported</label>
                        </div>
                    </div> -->

                    <div class="text-center">
                        <!-- <a href="flood-table.html" class="btn btn-danger">Cancel</a> -->
                        <button type="reset" class="btn btn-warning">Reset</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                
                </form><!-- End Form -->
            </div>
        </div><br>

        <div class="container">
          <div class="file-container">
          
            <h5 class="card-title">Data Table</h5>
        
            <!-- Table with stripped rows -->
            <div class="table-responsive" id="dashboard">
              <table class="table table-hover" id="dashboardTable">
                <thead class="table-dark">
                  <tr>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Flood Height</th>
                    <th>Elevation</th>
                    <th>Precipitation</th>
                    <th style="width: 80px">Action</th>
                  </tr>
                </thead>
                <tbody id="dashboardTableBody">
                  <!-- Display Data Here -->
                </tbody>
              </table>
              <!-- End Table with stripped rows -->
            </div>
      </div>
    </div><br>

        <!-- Modal for Edit Case -->
      <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">Edit Case</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Your form fields for editing here -->
              <form id="editCaseForm">
                <input type="hidden" id="editId">
                <div class="mb-3">
                  <label for="editLatitude" class="form-label">Latitude</label>
                  <input type="text" class="form-control" id="editLatitude" required>
                </div>
                <div class="mb-3">
                  <label for="editLongitude" class="form-label">Longitude</label>
                  <input type="text" class="form-control" id="editLongitude" required>
                </div>
                <div class="mb-3">
                  <label for="editHeight" class="form-label">Flood Height</label>
                  <input type="text" class="form-control" id="editHeight" required>
                </div>
                <div class="mb-3">
                  <label for="editElevation" class="form-label">Elevation</label>
                  <input type="text" class="form-control" id="editElevation" required>
                </div>
                <div class="mb-3">
                  <label for="editPrecipitation" class="form-label">Precipitation</label>
                  <input type="text" class="form-control" id="editPrecipitation" required>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="saveEdit()">Update</button>
            </div>
          </div>
        </div>
      </div>

        <div class="container">
            <!-- Container for file input and buttons with dark blue transparent background -->
            <div class="file-container">
                <h5 class="card-title">Data Visualization</h5>

                    <section class="section">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title">Line Chart</h5>
                            <!-- Line Chart -->
                            <canvas id="lineChart" style="max-flood_height: 400px;"></canvas>
                            <!-- End Line CHart -->
                          </div>
                        </div>
                
                          <div class="card">
                            <div class="card-body">
                              <h5 class="card-title">Bar Chart</h5>
                
                              <!-- Bar Chart -->
                              <canvas id="barChart" style="max-flood_height: 400px;"></canvas>
                              <!-- End Bar CHart -->
                
                            </div>
                          </div>
                
                          <div class="card">
                            <div class="card-body">
                              <h5 class="card-title">Pie Chart</h5>
                              <!-- Pie Chart -->
                              <canvas id="pieChart" style="max-flood_height: 400px;"></canvas>
                              <!-- End Pie CHart -->
                            </div>
                          </div>
                        </section>
                    </div>
                  </div><br>

            </div>
          </div>
</main><!-- End #main -->
</div>

  <!-- Include Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include Bootstrap JS and Popper.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Bootstrap Icons CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.15.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Include jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Include DataTables JS -->
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.js"></script>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
 
  <script src="bundle.js"></script>
  <script src="static/script.js"></script>

    <script>
      // Check if the user is authenticated
      const user = JSON.parse(localStorage.getItem('user'));
      if (!user) {
        // Redirect to the login page if not authenticated
        window.location.href = "login.html";
      }
    </script>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
      const addForm = document.getElementById('addForm');

      // Add an event listener for the form submission
      addForm.addEventListener('submit', function (e) {
        e.preventDefault(); // Prevent the default form submission

        // Get form data
        const latitude= document.getElementById('latitude').value;
        const longitude = document.getElementById('longitude').value;
        const flood_height = document.getElementById('flood_height').value;
        const elevation = document.getElementById('elevation').value;
        const precipitation = document.getElementById('precipitation').value;

        // Validate form data (you can add more validation if needed)
        if (!latitude || !longitude || !flood_height || !elevation || !precipitation) {
          // Show an error alert if any field is empty
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'All fields are required!',
          });
          return;
        }

        // Simulate a successful submission (you should replace this with your actual submission logic)
        // For demonstration purposes, always show the success alert
        Swal.fire({
          icon: 'success',
          title: 'Success!',
          text: 'New Flooding Case added Successfully!',
        });

        // Reset the form after a successful submission
        addForm.reset();
      });
    });
  </script>

<script>
  // Function to update the dashboard display
 function updateDashboard(data) {
   const dashboardTableBody = document.getElementById('dashboardTableBody');
   dashboardTableBody.innerHTML = ''; // Clear previous content

   data.forEach((caseData) => {
     const row = document.createElement('tr');
     row.innerHTML = `
       <td>${caseData.latitude}</td>
       <td>${caseData.longitude}</td>
       <td>${caseData.flood_height}</td>
       <td>${caseData.elevation}</td>
       <td>${caseData.precipitation}</td>
       <td>
         <button type="button" class="btn btn-warning" onclick="openEditModal('${caseData.id}', '${caseData.latitude}', ${caseData.longitude}, ${caseData.flood_height}, '${caseData.elevation}', '${caseData.precipitation}')">
           <i class="bi bi-pencil"></i> <!-- Pencil icon for edit -->
         </button>
         <button type="button" class="btn btn-danger" onclick="deleteCase('${caseData.id}')">
           <i class="bi bi-trash"></i> <!-- Trash icon for delete -->
         </button>
       </td>
     `;
     dashboardTableBody.appendChild(row);
   });

   // Initialize DataTable after updating the content
   $('#dashboardTable').DataTable();
 }

  // Function to open the Edit modal and pre-fill data
  function openEditModal(id, latitude, longitude, flood_height, elevation, precipitation) {
      // Set the values of the input fields in the modal
      document.getElementById('editId').value = id;
      document.getElementById('editLatitude').value = latitude;
      document.getElementById('editLongitude').value = longitude;
      document.getElementById('editHeight').value = flood_height;
      document.getElementById('editElevation').value = elevation;
      document.getElementById('editPrecipitation').value = precipitation;
  
      // Show the Edit modal
      const editModal = new bootstrap.Modal(document.getElementById('editModal'));
      editModal.show();
    }

    async function saveEdit() {
      const editId = document.getElementById('editId').value;
      const editLatitude = document.getElementById('editLatitude').value;
      const editLongitude = parseInt(document.getElementById('editLongitude').value);
      const editHeight = parseInt(document.getElementById('editHeight').value);
      const editElevation = document.getElementById('editElevation').value;
      const editPrecipitation = document.getElementById('editPrecipitation').value;
  
      try {
        // Update the document in Firestore
        await updateDoc(doc(colRef, editId), {
          latitude: editLatitude,
          longitude: editLongitude,
          flood_height: editHeight,
          elevation: editElevation,
          precipitation: editPrecipitation,
        });
  
        // Close the modal
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        editModal.hide();
      } catch (error) {
        console.error('Error updating document: ', error);
      }
    }

    // Add a listener for the form submission
    const editCaseForm = document.getElementById('editCaseForm');
    editCaseForm.addEventListener('submit', function (e) {
      e.preventDefault();
      saveEdit();
    });
  </script>

  
</body>
</html>
